#Path to your oh-my-zsh configuration.
ZSH=$HOME/.oh-my-zsh

# Set name of the theme to load.
ZSH_THEME="oriol"

HISTSIZE=50000
SAVEHIST=10000
setopt EXTENDED_HISTORY
setopt HIST_EXPIRE_DUPS_FIRST # If trim needed, do it for the dups first, nou unique
setopt HIST_IGNORE_DUPS # if executing same command in a row, save it only once
setopt HIST_IGNORE_SPACE # If a command starts with a space, do not save it
setopt INC_APPEND_HISTORY # Save commands as soon as you run it
setopt NO_SHARE_HISTORY # Do not share history between sessions

setopt AUTO_CD # If the executed command is not a normal command but a directory, cd to it
setopt AUTO_PUSHD # Make cd push the old directory onto the directory stack
setopt APPEND_HISTORY
setopt PUSHD_IGNORE_DUPS # Don’t push multiple copies of the same directory onto the directory stack
setopt PUSHDMINUS # Swaps the meaning of cd +1 and cd -1
setopt AUTO_MENU # Automatically use menu completion after the second consecutive request for completion
setopt ALWAYS_TO_END # The cursor is moved to the end of the word if either a single match is inserted or menu completion is performed
setopt COMPLETE_IN_WORD # The cursor is not set to the end of the word if completion is started
setopt FLOW_CONTROL # Disables the use of ⌃S to stop terminal output and the use of ⌃Q to resume it
setopt MENU_COMPLETE # Prevents the completion menu from showing even if AUTO_MENU is set
setopt PROMPT_SUBST # Adds support for command substitution

# COMPLETION SETTINGS
# fpath=(~/.dotfiles/zsh/completions $fpath) 
# zstyle ":completion:*" verbose yes
# zstyle ":completion:*:descriptions" format "%B%d%b"
# zstyle ":completion:*:messages" format "%d"
# zstyle ":completion:*:warnings" format "No matches for: %d"
# zstyle ":completion:*" group-name ”

# Set to this to use case-sensitive completion
CASE_SENSITIVE="true"

plugins=(
    colored-man-pages
    command-not-found
    extract
    forgit
    fzf-tab
    jsontools
    sudo
    web-search
    z
    zsh-autosuggestions
    # zsh-completions
    zsh-syntax-highlighting
    zsh-history-substring-search
)
# autoload -U compinit && compinit

DISABLE_AUTO_TITLE="true"
autoload -U zmv
setopt correct

# Al navegar per l'historial de comandes, deixar el cursor al final de la comanda
unsetopt global_rcs

source $ZSH/oh-my-zsh.sh

# User configuration
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=#155b6d"
export PATH=$HOME/.bin:/usr/local/bin:/bin:/usr/local/sbin:/usr/sbin:/sbin:/usr/bin:/usr/local/opt/sqlite/bin:$PATH
export VIRTUAL_ENV_DISABLE_PROMPT=disable

export HOMEBREW_CASK_OPTS="--appdir=/Applications"

export EVENT_NOKQUEUE=1

# Preferred editor for local and remote sessions
if [[ -n $SSH_CONNECTION ]]; then
  export EDITOR='vim'
else
  export EDITOR='nvim'
fi
export VISUAL='nvim'
export EDITOR='nvim'

export LC_ALL=en_US.UTF-8

# Highlight man pages with bat
export MANPAGER="sh -c 'col -bx | bat -l man -p'"

# Utilitza Solarized dark per veure els fitxers
export BAT_THEME="solarizedDark"

bindkey -v 

# Allow using C-s in terminal
bindkey -r '\C-s'
stty -ixon
stty stop undef

# vi style incremental search
bindkey '^A' beginning-of-line
bindkey '^E' end-of-line

bindkey '^B' backward-word
bindkey '^H' backward-kill-word

# Arrow up
bindkey '\e0A' history-search-backward
bindkey '\e[A' history-search-backward

# Arrow down
bindkey '\e0B' history-search-forward
bindkey '\e[B' history-search-forward

# Arrow right
bindkey '\e0C' forward-char
bindkey '\e[C' forward-char

# Arrow left
bindkey '\e0D' backward-char
bindkey '\e[D' backward-char

# Same as above, but with more vim-like traversal
bindkey '\C-k' history-search-backward
bindkey '\C-j' history-search-forward
bindkey '\C-h' backward-char
bindkey '\C-l' forward-char

bindkey '\e[1~' beginning-of-line
bindkey '\e[4~' end-of-line
bindkey '\eOF' end-of-line
bindkey '\eOH' beginning-of-line
bindkey '\e[3~' delete-char # Del
bindkey '\e[6~' end-of-history
bindkey '\e[5~' beginning-of-history

[[ -f $HOME/.aliases ]] && source $HOME/.aliases
[[ -f $HOME/.aliases.local ]] && source $HOME/.aliases.local

# Common settings
[[ -f $HOME/.profile ]] && source $HOME/.profile
# User settings
[[ -f $HOME/.user_profile ]] && source $HOME/.user_profile
# User settings
[[ -f $HOME/.zshrc.local ]] && source $HOME/.zshrc.local

# Keypad
# 0 . Enter
bindkey -s "^[Op" "0"
bindkey -s "^[Ol" "."
bindkey -s "^[OM" "^M"
# 1 2 3
bindkey -s "^[Oq" "1"
bindkey -s "^[Or" "2"
bindkey -s "^[Os" "3"
# 4 5 6
bindkey -s "^[Ot" "4"
bindkey -s "^[Ou" "5"
bindkey -s "^[Ov" "6"
# 7 8 9
bindkey -s "^[Ow" "7"
bindkey -s "^[Ox" "8"
bindkey -s "^[Oy" "9"
# + -  * / =
bindkey -s "^[Ok" "+"
bindkey -s "^[Om" "-"
bindkey -s "^[Oj" "*"
bindkey -s "^[Oo" "/"
bindkey -s "^[OX" "="

if [[ `uname` == 'Linux' ]]; then
elif [[ `uname` == 'Darwin' ]]; then
    source $HOME/.zshrc-osx
fi

if [[ "$TERM" != "screen-256color" ]]; then
    ts "$USER"
fi

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh
[ -f ~/.fzf-forgit.zsh ] && source ~/.fzf-forgit.zsh

# zsh-history-substring-search key bindings
bindkey '^P' history-substring-search-up
bindkey '^N' history-substring-search-down

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
